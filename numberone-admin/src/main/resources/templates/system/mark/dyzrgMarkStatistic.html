<!DOCTYPE html><html lang="zh" xmlns:th="http://www.thymeleaf.org"      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro"><meta charset="utf-8"><head th:include="include :: header"></head><link th:href="@{/ajax/libs/jquery-layout/jquery.layout-latest.css}" rel="stylesheet"/><link th:href="@{/ajax/libs/jquery-ztree/3.5/css/metro/zTreeStyle.css}" rel="stylesheet"/><body class="gray-bg"><div class="ui-layout-west">    <div class="main-content">        <div class="box box-main">            <div class="box-header">                <div class="box-title">                    <i class="fa icon-grid"></i> 组织机构                </div>                <div class="box-tools pull-right">                    <!--<a type="button" class="btn btn-box-tool menuItem" href="#" onclick="dept()" title="管理部门"><i class="fa fa-edit"></i></a>-->                    <button type="button" class="btn btn-box-tool" id="btnExpand" title="展开" style="display:none;"><i                            class="fa fa-chevron-up"></i></button>                    <button type="button" class="btn btn-box-tool" id="btnCollapse" title="折叠"><i                            class="fa fa-chevron-down"></i></button>                    <button type="button" class="btn btn-box-tool" id="btnRefresh" title="刷新部门"><i                            class="fa fa-refresh"></i></button>                </div>            </div>            <div class="ui-layout-content">                <div id="tree" class="ztree"></div>            </div>        </div>    </div></div><div class="container-div ui-layout-center">    <div class="row">        <!--查询框开始-->        <div class="col-sm-12 search-collapse">            <form id="user-form">                <input type="hidden" id="deptId" name="deptId">                <input type="hidden" id="parentId" name="parentId">                <div class="select-list">                    <ul>                        <li class="select-time">                            <label>自评时间： </label>                            <input type="text" class="time-input" placeholder="开始时间"                                   name="params[startTime]"/>                            <span>-</span>                            <input type="text" class="time-input" placeholder="结束时间"                                   name="params[endTime]"/>                        </li>                        <li>                            <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i                                    class="fa fa-search"></i>&nbsp;搜索</a>                            <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i                                    class="fa fa-refresh"></i>&nbsp;重置</a>                        </li>                    </ul>                </div>            </form>        </div>        <!--查询框结束-->        <div class="btn-group-sm hidden-xs" id="toolbar" role="group">            <a class="btn btn-warning" onclick="$.table.exportExcel()">                <i class="fa fa-download"></i> 导出            </a>        </div>        <div class="col-sm-12 select-table table-striped">            <table id="bootstrap-table" data-mobile-responsive="true"></table>        </div>    </div></div><div th:include="include :: footer"></div><script th:src="@{/ajax/libs/jquery-layout/jquery.layout-latest.js}"></script><script th:src="@{/ajax/libs/jquery-ztree/3.5/js/jquery.ztree.all-3.5.js}"></script><script th:inline="javascript">    var prefix = ctx + "system/dyzrgMark/markDZB/statistic";    var editFlag = [[${@permission.hasPermi('system:role:edit')}]];    var removeFlag = [[${@permission.hasPermi('system:role:remove')}]];    var datas = [[${@dict.getType('sys_normal_disable')}]];    function queryUserList() {        var options = {            url: prefix + "/list",            createUrl: prefix + "/add",            updateUrl: prefix + "/edit",            removeUrl: prefix + "/remove",            exportUrl: prefix + "/export",            pagination: "false",            sidePagination: "client",            removeRealUrl: prefix + "/removeReal",            sortName: "dept_name",            modalName: "总分及平均分统计",            dataField: "row",            search: false,            showExport: false,            columns: [{                checkbox: true            },                {                    field: 'majorKey',                    title: '主键',                    sortable: true                },                {                    field: 'user_id',                    title: '用户ID',                    sortable: true                },                {                    field: 'user_name',                    title: '用户名称',                    sortable: true                },                {                    field: 'dept_name',                    title: '部门名称',                    sortable: true                },                {                    field: 'smark_mark',                    title: '自评得分',                    sortable: true                },                {                    field: 'lmark_mark',                    title: '小组评得分',                    sortable: true                },                {                    field: 'dmark_mark',                    title: '党支部评得分',                    sortable: true                },                {                    field: 'avesmark_mark',                    title: '自评平均分',                    sortable: true                },                {                    field: 'avelmark_mark',                    title: '小组评平均分',                    sortable: true                },                {                    field: 'avedmark_mark',                    title: '党支部评平均分',                    sortable: true                }]        };        $.table.init(options);    }    $(function () {        var panehHidden = false;        if ($(this).width() < 769) {            panehHidden = true;        }        $('body').layout({initClosed: panehHidden, west__size: 185});        queryUserList();        $('#bootstrap-table').bootstrapTable('hideColumn', 'majorKey');        $('#bootstrap-table').bootstrapTable('hideColumn', 'user_id');        queryDeptTree();    });    // 获取所在部门为叶子节点的组织机构树    function queryDeptTree() {        var url = ctx + "system/dept/treeDataById";        var options = {            url: url,            expandLevel: 2,            onClick: zOnClick        };        $.tree.init(options);        function zOnClick(event, treeId, treeNode) {            $("#deptId").val(treeNode.id);            $("#parentId").val(treeNode.pId);            $.table.search();        }    }    $('#btnExpand').click(function () {        $._tree.expandAll(true);        $(this).hide();        $('#btnCollapse').show();    });    $('#btnCollapse').click(function () {        $._tree.expandAll(false);        $(this).hide();        $('#btnExpand').show();    });    $('#btnRefresh').click(function () {        queryDeptTree();    });</script></body></html>